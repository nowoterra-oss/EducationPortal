<!DOCTYPE html>
<html>
<head>
    <title>MelaLearning Otomatik Ä°ndirici</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin: 10px; }
        button:hover { background: #218838; }
        .loading { color: #dc3545; font-weight: bold; }
        .success { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ MelaLearning Ãœniversite Ä°ndirici</h1>
        <p>Bu araÃ§ ile MelaLearning'deki TÃœM Ã¼niversiteleri otomatik indirebilirsin.</p>
        
        <button onclick="testConnection()">ğŸ”— BAÄLANTI TESTÄ°</button>
        <button onclick="startScraping()">ğŸš€ TÃœM ÃœNÄ°VERSÄ°TELERÄ° Ä°NDÄ°R</button>
        
        <div id="status"></div>
        <div id="progress"></div>
    </div>

    <script>
    async function testConnection() {
        const status = document.getElementById('status');
        status.innerHTML = '<div class="loading">â³ MelaLearning baÄŸlantÄ±sÄ± test ediliyor...</div>';
        
        try {
            const response = await fetch('https://app.maialearning.com/api/universities?page=1&limit=5', {
                method: 'GET',
                credentials: 'include'
            });
            
            if (response.ok) {
                const data = await response.json();
                status.innerHTML = `<div class="success">âœ… BAÄLANTI BAÅARILI! Ä°lk sayfada ${data.length} Ã¼niversite bulundu.</div>`;
            } else {
                status.innerHTML = `<div class="loading">âŒ BaÄŸlantÄ± hatasÄ±: ${response.status}</div>`;
            }
        } catch (error) {
            status.innerHTML = `<div class="loading">âŒ Hata: ${error.message}</div>`;
        }
    }

    async function startScraping() {
        const status = document.getElementById('status');
        const progress = document.getElementById('progress');
        
        status.innerHTML = '<div class="loading">ğŸš€ TÃœM Ã¼niversiteler indirilmeye baÅŸlanÄ±yor...</div>';
        
        let allUniversities = [];
        let page = 1;
        let hasMore = true;

        while (hasMore && page <= 100) {
            progress.innerHTML = `<div class="loading">ğŸ“¥ Sayfa ${page} indiriliyor...</div>`;
            
            try {
                const response = await fetch(`https://app.maialearning.com/api/universities?page=${page}&limit=100`, {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    if (!data || data.length === 0) {
                        hasMore = false;
                        progress.innerHTML += `<div class="success">âœ… TÃ¼m veriler alÄ±ndÄ±!</div>`;
                        break;
                    }
                    
                    allUniversities = allUniversities.concat(data);
                    progress.innerHTML += `<div class="success">âœ… Sayfa ${page}: ${data.length} Ã¼niversite eklendi</div>`;
                    page++;
                    
                    // 2 saniye bekle
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                } else {
                    progress.innerHTML += `<div class="loading">âŒ Sayfa ${page} hatasÄ±: ${response.status}</div>`;
                    break;
                }
            } catch (error) {
                progress.innerHTML += `<div class="loading">âŒ Sayfa ${page} hatasÄ±: ${error.message}</div>`;
                break;
            }
        }

        // DOSYAYI Ä°NDÄ°R
        if (allUniversities.length > 0) {
            const blob = new Blob([JSON.stringify(allUniversities, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `maialearning_${allUniversities.length}_universite.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            status.innerHTML += `<div class="success">ğŸ‰ BAÅARILI! ${allUniversities.length} Ã¼niversite indirildi!</div>`;
        } else {
            status.innerHTML += `<div class="loading">âŒ HiÃ§ Ã¼niversite bulunamadÄ±</div>`;
        }
    }
    </script>
</body>
</html>